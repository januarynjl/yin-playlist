<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>懒銀歌单</title>
    <link href="./layui/css/layui.css" rel="stylesheet">
</head>
<body>
<!-- HTML Content -->
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-header"><p style="text-align: center">懒銀歌单 总数：<span id="count">0</span></p></div>
        <div class="layui-card-body">
            <form class="layui-form layui-row layui-col-space16"  lay-filter="search-filter">
                <div class="layui-col-md3">
                    <div class="layui-input-wrap">
                        <input type="text" name="songNm" value="" placeholder="歌名" class="layui-input" lay-affix="clear">
                    </div>
                </div>
                <div class="layui-col-md3">
                    <div class="layui-input-wrap">
                        <input type="text" name="singer" placeholder="歌手" lay-affix="clear" class="layui-input">
                    </div>
                </div>
                <div class="layui-col-md3">
                    <div class="layui-input-wrap">
                       <!-- <input type="text" name="sign" placeholder="风格" lay-affix="clear" class="layui-input">-->
                        <select class="layui-input" name="sign" placeholder="风格"  lay-affix="clear">
                            <option value="">风格</option>
                            <option value="悲伤情歌">悲伤情歌</option>
                            <option value="古风国风">古风国风</option>
                            <option value="活泼可爱">活泼可爱</option>
                            <option value="温柔治愈">温柔治愈</option>
                            <option value="民谣乐队">民谣乐队</option>
                            <option value="喧嚣帅气">喧嚣帅气</option>
                        </select>
                    </div>
                </div>
                <div class="layui-col-md3">
                    <div class="layui-input-wrap">
                        <input type="text" name="pre" placeholder="首字母" lay-affix="clear" class="layui-input">
                    </div>
                </div>
                <div class="layui-btn-container layui-col-xs12">
                    <button class="layui-btn" lay-submit lay-filter="playlist-search" id="btn-submit">搜索</button>
                    <button type="reset" class="layui-btn layui-btn-primary"  id="btn-clear">清除</button>
                </div>
            </form>

            <table class="layui-table" id="playList-table"></table>
        </div>
    </div>

</div>

<script src="./layui/layui.js"></script>
<script>
    var playList_origin;
    layui.define(['jquery'], function(exports){
        var $ = layui.jquery;

        var fetchData = function(url, callback) {
            $.getJSON(url, function(data) {
                callback(data);
            });
        };

        exports('dataModule', {fetchData: fetchData}); // 导出模块功能
    });


    // Usage
    layui.use(function(){
        var $ = layui.$;
        var form = layui.form;
        var table = layui.table;
        var dataModule = layui.dataModule;
        dataModule.fetchData('./data/playList.json', function(data) {
            playList_origin = data;
            $("#count").text(data.length);
            playList = playList_origin;
            // 创建表格实例
            table.render({
                elem: '#playList-table',
                size:'lg',
                data: playList,
                cols: [[
                    {type: 'numbers', title: '序号',width:60},
                    {field:'songNm', title: '歌名',maxWidth:300,minWidth:150},
                    {field:'singer', title: '歌手', width:150},
                    {field:'sign', title: '风格', width:150},
                    {field:'pre', title: '首字母', width:80}/*,
                    {field:'upDown', title: '升降调',  width:80}*/
                ]],

                //skin: 'line', // 表格风格
                even: true,
                page: false, // 是否显示分页
                limits: [10, 20, 50],
                limit: 20 // 每页默认显示的数量
            });
        });
        $('#btn-submit').on('click', function(){
            form.submit('search-filter', function(data){
                var field = data.field; // 获取表单全部字段值
                console.log(field);// 回调函数返回的 data 参数和提交事件中返回的一致
                search(field);

            });
            return false;
        });
        $('#btn-clear').on('click', function(){
            search({songNm: '', singer: '', sign: '', pre: ''})
        });
        function search(field){
            let filter_list = []
            let cdata = playList_origin;
            if(field.songNm == "" && field.singer == "" && field.sign == ""  && field.pre == ""){
                filter_list = cdata;
            }else{
                $.each(cdata, function (i, row) {
                    var isSearchInRow = 0;
                    if(field.songNm != "" && row.songNm.indexOf(field.songNm)> -1){
                        isSearchInRow = 1;
                    }
                    if(field.singer != "" && row.singer.indexOf(field.singer)> -1){
                        isSearchInRow = 1;
                    }
                    if(field.sign != "" && row.sign.indexOf(field.sign)> -1){
                        isSearchInRow = 1;
                    }
                    if(field.pre != "" && row.pre == field.pre.toUpperCase()){
                        isSearchInRow = 1;
                    }
                    if (isSearchInRow == 1) {
                        filter_list.push(row)

                    }
                });
            }
            // 执行搜索重载
            table.reload('playList-table', {
                data: filter_list,
            });
        }
    });

</script>
</body>
</html>